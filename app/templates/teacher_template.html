<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Lehrer-Vertretungen</title>
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
      }
      #table-container {
        height: calc(100vh - 10vh);
        overflow-y: auto;
        padding: 10px;
        padding-bottom: 20vh;
      }
      table {
        width: 95%;
        border-collapse: collapse;
        font-size: 1.5vw;
        margin: 0 auto;
      }
      th,
      td {
        border: 1px solid #333;
        padding: 8px;
        text-align: center;
      }
      th {
        background: #cc6600;
        color: #fff;
      }
      tbody tr:nth-child(odd) {
        background-color: #ffffff; /* weiß */
      }
      tbody tr:nth-child(even) {
        background-color: #ffaa00; /* hellgrau */
      }
      #banner {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 10vh;
        border-top: 1px solid #444;
        padding: 8px;
        background: #e0e0e0;
        font-size: 8vh;
        line-height: 10vh;
        text-align: center;
        color: red;
        overflow: hidden;
        white-space: nowrap;
      }
      .signature {
        text-align: right;
        font-size: 1vw;
        color: #b1a5a5;
        margin-top: 1em;
      }
      .footer-spacer {
        height: 10vh;
      }
    </style>
  </head>
  <body>
    <div id="table-container">
      <div class="footer-spacer"></div>
      <h2>Vertretungen am {{ today }}</h2>
      <table>
        <tr>
          <th>Lehrer</th>
          <th>Stunde</th>
          <th>Raum</th>
          <th>Klasse</th>
          <th>Fach</th>
        </tr>
        {% for row in rows %}
        <tr>
          <td>{{ row.teacher }}</td>
          <td>{{ row.start }}–{{ row.end }}</td>
          <td>{{ row.room }}</td>
          <td>{{ row.classes|join(", ")}}</td>
          <td>{{ row.subjects|join(", ") }}</td>
        </tr>
        {% endfor %}
      </table>
      <div class="signature">@Nargang</div>
      <div class="footer-spacer"></div>
    </div>

    <div id="banner">
      {% if banner.mode=='text' %}{{ banner.text }}{% endif %}
    </div>

    <script>
      const container = document.getElementById("table-container");
      const step = 1; // Pixel pro Scroll-Schritt
      const speed = 50; // ms zwischen den Schritten
      const refreshPerView = 30; // Sekunden, die eine volle „View“-Höhe dauern soll

      // gleich zum Start ganz nach oben springen
      container.scrollTop = 0;

      // Verhältnis Gesamt- zu sichtbarer Höhe berechnen
      const ratio = container.scrollHeight / container.clientHeight;
      // Gesamtdauer in ms für einen Durchlauf
      const reloadTime = ratio * refreshPerView * 1000;

      // Scroll-Intervall starten
      const scroller = setInterval(() => {
        container.scrollBy(0, step);
      }, speed);

      // Nach Ablauf der berechneten Zeit Intervall stoppen und Seite neu laden
      setTimeout(() => {
        clearInterval(scroller);
        window.location.reload();
      }, reloadTime);
    </script>
  </body>
</html>
